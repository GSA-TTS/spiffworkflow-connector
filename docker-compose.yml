# Derived from https://github.com/sartography/spiff-arena/blob/main/docker-compose.yml

services:
  spiffworkflow-connector:
    container_name: spiffworkflow-connector
    build:
      context: .
      dockerfile: Dockerfile
    user: ${RUN_AS:-0:0}
    environment:
      FLASK_ENV: "production"
      FLASK_DEBUG: "0"
      FLASK_SESSION_SECRET_KEY: "${FLASK_SESSION_SECRET_KEY:-super_secret_key}"
      CONNECTOR_PROXY_PORT: "${PORT:-8080}"
      POETRY_VIRTUALENVS_IN_PROJECT: "true"
      XDG_CACHE_HOME: "/app/.cache"
    env_file:
      - path: .env
        required: false      
    ports:
      - "${PORT:-8080}:${PORT:-8080}/tcp"
    healthcheck:
      test: "curl localhost:${PORT:-8080}/liveness --fail"
      interval: 10s
      timeout: 5s
      retries: 20
